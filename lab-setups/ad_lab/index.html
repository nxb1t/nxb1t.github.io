<!DOCTYPE html>
<html lang="en" class="h-full">
<head>
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-6E5Q6YSW8D"></script>
    <script data-cfasync="false">window.dataLayer = window.dataLayer || [];function gtag(){dataLayer.push(arguments);}gtag('js', new Date());gtag('config', 'G-6E5Q6YSW8D');</script>

    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <meta name="turbo-root" content="/retype">
    <meta name="turbo-cache-control" content="no-cache" data-turbo-track="reload" data-track-token="3.6.0.780240423184">

    <!-- See retype.com -->
    <meta name="generator" content="Retype 3.6.0">

    <!-- Primary Meta Tags -->
    <title>Active Directory Lab</title>
    <meta name="title" content="Active Directory Lab">
    <meta name="description" content="Hello everyone, welcome to my blog on setting up a simple AD lab for practicing Incident Response, Threat Hunting, and Digital Forensics.">

    <!-- Canonical -->
    <link rel="canonical" href="https://nxb1t.github.io/retype/lab-setups/ad_lab/">

    <!-- Open Graph / Facebook -->
    <meta property="og:type" content="website">
    <meta property="og:url" content="https://nxb1t.github.io/retype/lab-setups/ad_lab/">
    <meta property="og:title" content="Active Directory Lab">
    <meta property="og:description" content="Hello everyone, welcome to my blog on setting up a simple AD lab for practicing Incident Response, Threat Hunting, and Digital Forensics.">
    <meta property="og:image" content="https://nxb1t.github.io/retype/assets/img/ad_ir/infra.png">

    <!-- Twitter -->
    <meta property="twitter:card" content="summary_large_image">
    <meta property="twitter:url" content="https://nxb1t.github.io/retype/lab-setups/ad_lab/">
    <meta property="twitter:title" content="Active Directory Lab">
    <meta property="twitter:description" content="Hello everyone, welcome to my blog on setting up a simple AD lab for practicing Incident Response, Threat Hunting, and Digital Forensics.">
    <meta property="twitter:image" content="https://nxb1t.github.io/retype/assets/img/ad_ir/infra.png">

    <script data-cfasync="false">(function () { var el = document.documentElement, m = localStorage.getItem("doc_theme"), wm = window.matchMedia; if (m === "dark" || (!m && wm && wm("(prefers-color-scheme: dark)").matches)) { el.classList.add("dark") } else { el.classList.remove("dark") } })();</script>

    <link href="../../favicon.ico" rel="icon">
    <link href="../../resources/css/retype.css?v=3.6.0.780240423184" rel="stylesheet">

    <script data-cfasync="false" src="../../resources/js/config.js?v=3.6.0.780240423184" data-turbo-eval="false" defer></script>
    <script data-cfasync="false" src="../../resources/js/retype.js?v=3.6.0" data-turbo-eval="false" defer></script>
    <script id="lunr-js" data-cfasync="false" src="../../resources/js/lunr.js?v=3.6.0.780240423184" data-turbo-eval="false" defer></script>
    <script id="prism-js" data-cfasync="false" src="../../resources/js/prism.js?v=3.6.0.780240423184" defer></script>
</head>
<body>
    <div id="docs-app" class="relative text-base antialiased text-gray-700 bg-white font-body dark:bg-dark-850 dark:text-dark-300">
        <div class="absolute bottom-0 left-0 bg-gray-100 dark:bg-dark-800" style="top: 5rem; right: 50%"></div>
    
        <header id="docs-site-header" class="sticky top-0 z-30 flex w-full h-16 bg-white border-b border-gray-200 md:h-20 dark:bg-dark-850 dark:border-dark-650">
            <div class="container relative flex items-center justify-between pr-6 grow md:justify-start">
                <!-- Mobile menu button skeleton -->
                <button v-cloak class="skeleton docs-mobile-menu-button flex items-center justify-center shrink-0 overflow-hidden dark:text-white focus:outline-none rounded-full w-10 h-10 ml-3.5 md:hidden"><svg xmlns="http://www.w3.org/2000/svg" class="mb-px shrink-0" width="24" height="24" viewBox="0 0 24 24" role="presentation" style="margin-bottom: 0px;"><g fill="currentColor"><path d="M2 4h20v2H2zM2 11h20v2H2zM2 18h20v2H2z"></path></g></svg></button>
                <div v-cloak id="docs-sidebar-toggle"></div>
        
                <!-- Logo -->
                <div class="flex items-center justify-between h-full py-2 md:w-75">
                    <div class="flex items-center px-2 md:px-6">
                        <a id="docs-site-logo" href="../../" class="flex items-center leading-snug text-2xl">
                            <span class="dark:text-white font-semibold line-clamp-1 md:line-clamp-2">nxb1t</span>
                        </a><span class="hidden px-2 py-1 ml-4 text-sm font-semibold leading-none text-root-logo-label-text bg-root-logo-label-bg rounded-sm md:inline-block">is-a.dev</span>
                    </div>
        
                    <span class="hidden h-8 border-r md:inline-block dark:border-dark-650"></span>
                </div>
        
                <div class="flex justify-between md:grow">
                    <!-- Top Nav -->
                    <nav class="hidden md:flex">
                        <ul class="flex flex-col mb-4 md:pl-16 md:mb-0 md:flex-row md:items-center">
                            <li class="mr-6">
                                <a class="py-2 md:mb-0 inline-flex items-center text-sm whitespace-nowrap transition-colors duration-200 ease-linear md:text-blue-500 dark:text-blue-400 hover:text-blue-800 dark:hover:text-blue-200" href="https://nxb1t.neocities.org" target="_blank">
                                    <svg xmlns="http://www.w3.org/2000/svg" class="mb-px mr-1" width="18" height="18" viewBox="0 0 24 24" role="presentation">
                                        <g fill="currentColor">
                                            <path d="M8.75 7a.75.75 0 0 0 0 1.5h7.5a.75.75 0 0 0 0-1.5h-7.5ZM7 11.75a.75.75 0 0 1 .75-.75h6.5a.75.75 0 0 1 0 1.5h-6.5a.75.75 0 0 1-.75-.75ZM9.75 15a.75.75 0 0 0 0 1.5h6.5a.75.75 0 0 0 0-1.5h-6.5Z"></path><path d="M2 3.75C2 2.784 2.784 2 3.75 2h16.5c.966 0 1.75.784 1.75 1.75v16.5A1.75 1.75 0 0 1 20.25 22H3.75A1.75 1.75 0 0 1 2 20.25Zm1.75-.25a.25.25 0 0 0-.25.25v16.5c0 .138.112.25.25.25h16.5a.25.25 0 0 0 .25-.25V3.75a.25.25 0 0 0-.25-.25Z"></path>
                                        </g>
                                    </svg>
                                    <span>CTF Writeups</span>
                                </a>
                            </li>
                            <li class="mr-6">
                                <a class="py-2 md:mb-0 inline-flex items-center text-sm whitespace-nowrap transition-colors duration-200 ease-linear md:text-blue-500 dark:text-blue-400 hover:text-blue-800 dark:hover:text-blue-200" href="https://github.com/nxb1t" target="_blank">
                                    <svg xmlns="http://www.w3.org/2000/svg" class="mb-px mr-1" width="18" height="18" viewBox="0 0 24 24" role="presentation">
                                        <g fill="currentColor">
                                            <path d="M12 0c-6.626 0-12 5.373-12 12 0 5.302 3.438 9.8 8.207 11.387.599.111.793-.261.793-.577v-2.234c-3.338.726-4.033-1.416-4.033-1.416-.546-1.387-1.333-1.756-1.333-1.756-1.089-.745.083-.729.083-.729 1.205.084 1.839 1.237 1.839 1.237 1.07 1.834 2.807 1.304 3.492.997.107-.775.418-1.305.762-1.604-2.665-.305-5.467-1.334-5.467-5.931 0-1.311.469-2.381 1.236-3.221-.124-.303-.535-1.524.117-3.176 0 0 1.008-.322 3.301 1.23.957-.266 1.983-.399 3.003-.404 1.02.005 2.047.138 3.006.404 2.291-1.552 3.297-1.23 3.297-1.23.653 1.653.242 2.874.118 3.176.77.84 1.235 1.911 1.235 3.221 0 4.609-2.807 5.624-5.479 5.921.43.372.823 1.102.823 2.222v3.293c0 .319.192.694.801.576 4.765-1.589 8.199-6.086 8.199-11.386 0-6.627-5.373-12-12-12z"/>
                                        </g>
                                    </svg>
                                    <span>GitHub</span>
                                </a>
                            </li>
                            <li class="mr-6">
                                <a class="py-2 md:mb-0 inline-flex items-center text-sm whitespace-nowrap transition-colors duration-200 ease-linear md:text-blue-500 dark:text-blue-400 hover:text-blue-800 dark:hover:text-blue-200" href="https://www.linkedin.com/in/nashid-p-694842226" target="_blank">
                                    <svg xmlns="http://www.w3.org/2000/svg" class="mb-px mr-1" width="18" height="18" viewBox="0 0 24 24" role="presentation">
                                        <g fill="currentColor">
                                            <path d="M19 0h-14c-2.761 0-5 2.239-5 5v14c0 2.761 2.239 5 5 5h14c2.762 0 5-2.239 5-5v-14c0-2.761-2.238-5-5-5zm-11 19h-3v-11h3v11zm-1.5-12.268c-.966 0-1.75-.79-1.75-1.764s.784-1.764 1.75-1.764 1.75.79 1.75 1.764-.783 1.764-1.75 1.764zm13.5 12.268h-3v-5.604c0-3.368-4-3.113-4 0v5.604h-3v-11h3v1.765c1.396-2.586 7-2.777 7 2.476v6.759z"/>
                                        </g>
                                    </svg>
                                    <span>LinkedIn</span>
                                </a>
                            </li>
                            <li class="mr-6">
                                <a class="py-2 md:mb-0 inline-flex items-center text-sm whitespace-nowrap transition-colors duration-200 ease-linear md:text-blue-500 dark:text-blue-400 hover:text-blue-800 dark:hover:text-blue-200" href="https://infosec.exchange/@nxb1t" target="_blank">
                                    <img class="mb-px mr-1" width="18" alt="" src="https://img.icons8.com/external-tal-revivo-color-tal-revivo/24/null/external-mastodon-is-an-online-self-hosted-social-media-and-social-networking-service-logo-color-tal-revivo.png">
                                    <span>Mastodon</span>
                                </a>
                            </li>
                            <li class="mr-6">
                                <a class="py-2 md:mb-0 inline-flex items-center text-sm whitespace-nowrap transition-colors duration-200 ease-linear md:text-blue-500 dark:text-blue-400 hover:text-blue-800 dark:hover:text-blue-200" href="https://twitter.com/nxb1t4n6" target="_blank">
                                    <svg xmlns="http://www.w3.org/2000/svg" class="mb-px mr-1" width="18" height="18" viewBox="0 0 24 24" role="presentation">
                                        <g fill="currentColor">
                                            <path d="M19 0h-14c-2.761 0-5 2.239-5 5v14c0 2.761 2.239 5 5 5h14c2.762 0 5-2.239 5-5v-14c0-2.761-2.238-5-5-5zm-.139 9.237c.209 4.617-3.234 9.765-9.33 9.765-1.854 0-3.579-.543-5.032-1.475 1.742.205 3.48-.278 4.86-1.359-1.437-.027-2.649-.976-3.066-2.28.515.098 1.021.069 1.482-.056-1.579-.317-2.668-1.739-2.633-3.26.442.246.949.394 1.486.411-1.461-.977-1.875-2.907-1.016-4.383 1.619 1.986 4.038 3.293 6.766 3.43-.479-2.053 1.08-4.03 3.199-4.03.943 0 1.797.398 2.395 1.037.748-.147 1.451-.42 2.086-.796-.246.767-.766 1.41-1.443 1.816.664-.08 1.297-.256 1.885-.517-.439.656-.996 1.234-1.639 1.697z"/>
                                        </g>
                                    </svg>
                                    <span>Twitter</span>
                                </a>
                            </li>
        
                        </ul>
                    </nav>
        
                    <!-- Header Right Skeleton -->
                    <div v-cloak class="flex justify-end grow skeleton">
        
                        <!-- Search input mock -->
                        <div class="relative hidden w-40 lg:block lg:max-w-sm lg:ml-auto">
                            <div class="absolute flex items-center justify-center h-full pl-3 dark:text-dark-300">
                                <svg xmlns="http://www.w3.org/2000/svg" class="icon-base" width="16" height="16" viewBox="0 0 24 24" aria-labelledby="icon" role="presentation" style="margin-bottom: 1px;"><g fill="currentColor" ><path d="M21.71 20.29l-3.68-3.68A8.963 8.963 0 0020 11c0-4.96-4.04-9-9-9s-9 4.04-9 9 4.04 9 9 9c2.12 0 4.07-.74 5.61-1.97l3.68 3.68c.2.19.45.29.71.29s.51-.1.71-.29c.39-.39.39-1.03 0-1.42zM4 11c0-3.86 3.14-7 7-7s7 3.14 7 7c0 1.92-.78 3.66-2.04 4.93-.01.01-.02.01-.02.01-.01.01-.01.01-.01.02A6.98 6.98 0 0111 18c-3.86 0-7-3.14-7-7z" ></path></g></svg>
                            </div>
                            <input class="w-full h-10 placeholder-gray-400 transition-colors duration-200 ease-in bg-gray-200 border border-transparent rounded md:text-sm hover:bg-white hover:border-gray-300 focus:outline-none focus:bg-white focus:border-gray-500 dark:bg-dark-600 dark:border-dark-600 dark:placeholder-dark-400" style="padding: 0.625rem 0.75rem 0.625rem 2rem" type="text" placeholder="Search">
                        </div>
        
                        <!-- Mobile search button -->
                        <div class="flex items-center justify-center w-10 h-10 lg:hidden">
                            <svg xmlns="http://www.w3.org/2000/svg" class="shrink-0 icon-base" width="20" height="20" viewBox="0 0 24 24" aria-labelledby="icon" role="presentation" style="margin-bottom: 0px;"><g fill="currentColor" ><path d="M21.71 20.29l-3.68-3.68A8.963 8.963 0 0020 11c0-4.96-4.04-9-9-9s-9 4.04-9 9 4.04 9 9 9c2.12 0 4.07-.74 5.61-1.97l3.68 3.68c.2.19.45.29.71.29s.51-.1.71-.29c.39-.39.39-1.03 0-1.42zM4 11c0-3.86 3.14-7 7-7s7 3.14 7 7c0 1.92-.78 3.66-2.04 4.93-.01.01-.02.01-.02.01-.01.01-.01.01-.01.02A6.98 6.98 0 0111 18c-3.86 0-7-3.14-7-7z" ></path></g></svg>
                        </div>
        
                        <!-- Dark mode switch placeholder -->
                        <div class="w-10 h-10 lg:ml-2"></div>
        
                        <!-- History button -->
                        <div class="flex items-center justify-center w-10 h-10" style="margin-right: -0.625rem;">
                            <svg xmlns="http://www.w3.org/2000/svg" class="shrink-0 icon-base" width="22" height="22" viewBox="0 0 24 24" aria-labelledby="icon" role="presentation" style="margin-bottom: 0px;"><g fill="currentColor" ><g ><path d="M12.01 6.01c-.55 0-1 .45-1 1V12a1 1 0 00.4.8l3 2.22a.985.985 0 001.39-.2.996.996 0 00-.21-1.4l-2.6-1.92V7.01c.02-.55-.43-1-.98-1z"></path><path d="M12.01 1.91c-5.33 0-9.69 4.16-10.05 9.4l-.29-.26a.997.997 0 10-1.34 1.48l1.97 1.79c.19.17.43.26.67.26s.48-.09.67-.26l1.97-1.79a.997.997 0 10-1.34-1.48l-.31.28c.34-4.14 3.82-7.41 8.05-7.41 4.46 0 8.08 3.63 8.08 8.09s-3.63 8.08-8.08 8.08c-2.18 0-4.22-.85-5.75-2.4a.996.996 0 10-1.42 1.4 10.02 10.02 0 007.17 2.99c5.56 0 10.08-4.52 10.08-10.08.01-5.56-4.52-10.09-10.08-10.09z"></path></g></g></svg>
                        </div>
                    </div>
        
                    <div v-cloak class="flex justify-end grow">
                        <div id="docs-mobile-search-button"></div>
                        <doc-search-desktop></doc-search-desktop>
        
                        <doc-theme-switch class="lg:ml-2"></doc-theme-switch>
                        <doc-history></doc-history>
                    </div>
                </div>
            </div>
        </header>
    
        <div class="container relative flex bg-white">
            <!-- Sidebar Skeleton -->
            <div v-cloak class="fixed flex flex-col shrink-0 duration-300 ease-in-out bg-gray-100 border-gray-200 sidebar top-20 w-75 border-r h-screen md:sticky transition-transform skeleton dark:bg-dark-800 dark:border-dark-650">
            
                <!-- Render this div, if config.showSidebarFilter is `true` -->
                <div class="flex items-center h-16 px-6">
                    <input class="w-full h-8 px-3 py-2 transition-colors duration-200 ease-linear bg-white border border-gray-200 rounded shadow-none text-sm focus:outline-none focus:border-gray-600 dark:bg-dark-600 dark:border-dark-600" type="text" placeholder="Filter">
                </div>
            
                <div class="pl-6 mt-1 mb-4">
                    <div class="w-32 h-3 mb-4 bg-gray-200 rounded-full loading dark:bg-dark-600"></div>
                    <div class="w-48 h-3 mb-4 bg-gray-200 rounded-full loading dark:bg-dark-600"></div>
                    <div class="w-40 h-3 mb-4 bg-gray-200 rounded-full loading dark:bg-dark-600"></div>
                    <div class="w-32 h-3 mb-4 bg-gray-200 rounded-full loading dark:bg-dark-600"></div>
                    <div class="w-48 h-3 mb-4 bg-gray-200 rounded-full loading dark:bg-dark-600"></div>
                    <div class="w-40 h-3 mb-4 bg-gray-200 rounded-full loading dark:bg-dark-600"></div>
                </div>
            
                <div class="shrink-0 mt-auto bg-transparent dark:border-dark-650">
                    <a class="flex items-center justify-center flex-nowrap h-16 text-gray-400 dark:text-dark-400 hover:text-gray-700 dark:hover:text-dark-300 transition-colors duration-150 ease-in docs-powered-by" target="_blank" href="https://retype.com/" rel="noopener">
                        <span class="text-xs whitespace-nowrap">Powered by</span>
                        <svg xmlns="http://www.w3.org/2000/svg" class="ml-2" fill="currentColor" width="96" height="20" overflow="visible"><path d="M0 0v20h13.59V0H0zm11.15 17.54H2.44V2.46h8.71v15.08zM15.8 20h2.44V4.67L15.8 2.22zM20.45 6.89V20h2.44V9.34z"/><g><path d="M40.16 8.44c0 1.49-.59 2.45-1.75 2.88l2.34 3.32h-2.53l-2.04-2.96h-1.43v2.96h-2.06V5.36h3.5c1.43 0 2.46.24 3.07.73s.9 1.27.9 2.35zm-2.48 1.1c.26-.23.38-.59.38-1.09 0-.5-.13-.84-.4-1.03s-.73-.28-1.39-.28h-1.54v2.75h1.5c.72 0 1.2-.12 1.45-.35zM51.56 5.36V7.2h-4.59v1.91h4.13v1.76h-4.13v1.92h4.74v1.83h-6.79V5.36h6.64zM60.09 7.15v7.48h-2.06V7.15h-2.61V5.36h7.28v1.79h-2.61zM70.81 14.64h-2.06v-3.66l-3.19-5.61h2.23l1.99 3.45 1.99-3.45H74l-3.19 5.61v3.66zM83.99 6.19c.65.55.97 1.4.97 2.55s-.33 1.98-1 2.51-1.68.8-3.04.8h-1.23v2.59h-2.06V5.36h3.26c1.42 0 2.45.28 3.1.83zm-1.51 3.65c.25-.28.37-.69.37-1.22s-.16-.92-.48-1.14c-.32-.23-.82-.34-1.5-.34H79.7v3.12h1.38c.68 0 1.15-.14 1.4-.42zM95.85 5.36V7.2h-4.59v1.91h4.13v1.76h-4.13v1.92H96v1.83h-6.79V5.36h6.64z"/></g></svg>
                    </a>
                </div>
            </div>
            
            <!-- Sidebar component -->
            <doc-sidebar v-cloak>
                <template #sidebar-footer>
                    <div class="shrink-0 mt-auto border-t md:bg-transparent md:border-none dark:border-dark-650">
            
                        <div class="py-3 px-6 md:hidden border-b dark:border-dark-650">
                            <nav>
                                <ul class="flex flex-wrap justify-center items-center">
                                    <li class="mr-6">
                                        <a class="block py-1 inline-flex items-center text-sm whitespace-nowrap transition-colors duration-200 ease-linear md:text-blue-500 dark:text-blue-400 hover:text-blue-800 dark:hover:text-blue-200" href="https://nxb1t.neocities.org" target="_blank">
                                            <svg xmlns="http://www.w3.org/2000/svg" class="mb-px mr-1" width="18" height="18" viewBox="0 0 24 24" role="presentation">
                                                <g fill="currentColor">
                                                    <path d="M8.75 7a.75.75 0 0 0 0 1.5h7.5a.75.75 0 0 0 0-1.5h-7.5ZM7 11.75a.75.75 0 0 1 .75-.75h6.5a.75.75 0 0 1 0 1.5h-6.5a.75.75 0 0 1-.75-.75ZM9.75 15a.75.75 0 0 0 0 1.5h6.5a.75.75 0 0 0 0-1.5h-6.5Z"></path><path d="M2 3.75C2 2.784 2.784 2 3.75 2h16.5c.966 0 1.75.784 1.75 1.75v16.5A1.75 1.75 0 0 1 20.25 22H3.75A1.75 1.75 0 0 1 2 20.25Zm1.75-.25a.25.25 0 0 0-.25.25v16.5c0 .138.112.25.25.25h16.5a.25.25 0 0 0 .25-.25V3.75a.25.25 0 0 0-.25-.25Z"></path>
                                                </g>
                                            </svg>
                                            <span>CTF Writeups</span>
                                        </a>
                                    </li>
                                    <li class="mr-6">
                                        <a class="block py-1 inline-flex items-center text-sm whitespace-nowrap transition-colors duration-200 ease-linear md:text-blue-500 dark:text-blue-400 hover:text-blue-800 dark:hover:text-blue-200" href="https://github.com/nxb1t" target="_blank">
                                            <svg xmlns="http://www.w3.org/2000/svg" class="mb-px mr-1" width="18" height="18" viewBox="0 0 24 24" role="presentation">
                                                <g fill="currentColor">
                                                    <path d="M12 0c-6.626 0-12 5.373-12 12 0 5.302 3.438 9.8 8.207 11.387.599.111.793-.261.793-.577v-2.234c-3.338.726-4.033-1.416-4.033-1.416-.546-1.387-1.333-1.756-1.333-1.756-1.089-.745.083-.729.083-.729 1.205.084 1.839 1.237 1.839 1.237 1.07 1.834 2.807 1.304 3.492.997.107-.775.418-1.305.762-1.604-2.665-.305-5.467-1.334-5.467-5.931 0-1.311.469-2.381 1.236-3.221-.124-.303-.535-1.524.117-3.176 0 0 1.008-.322 3.301 1.23.957-.266 1.983-.399 3.003-.404 1.02.005 2.047.138 3.006.404 2.291-1.552 3.297-1.23 3.297-1.23.653 1.653.242 2.874.118 3.176.77.84 1.235 1.911 1.235 3.221 0 4.609-2.807 5.624-5.479 5.921.43.372.823 1.102.823 2.222v3.293c0 .319.192.694.801.576 4.765-1.589 8.199-6.086 8.199-11.386 0-6.627-5.373-12-12-12z"/>
                                                </g>
                                            </svg>
                                            <span>GitHub</span>
                                        </a>
                                    </li>
                                    <li class="mr-6">
                                        <a class="block py-1 inline-flex items-center text-sm whitespace-nowrap transition-colors duration-200 ease-linear md:text-blue-500 dark:text-blue-400 hover:text-blue-800 dark:hover:text-blue-200" href="https://www.linkedin.com/in/nashid-p-694842226" target="_blank">
                                            <svg xmlns="http://www.w3.org/2000/svg" class="mb-px mr-1" width="18" height="18" viewBox="0 0 24 24" role="presentation">
                                                <g fill="currentColor">
                                                    <path d="M19 0h-14c-2.761 0-5 2.239-5 5v14c0 2.761 2.239 5 5 5h14c2.762 0 5-2.239 5-5v-14c0-2.761-2.238-5-5-5zm-11 19h-3v-11h3v11zm-1.5-12.268c-.966 0-1.75-.79-1.75-1.764s.784-1.764 1.75-1.764 1.75.79 1.75 1.764-.783 1.764-1.75 1.764zm13.5 12.268h-3v-5.604c0-3.368-4-3.113-4 0v5.604h-3v-11h3v1.765c1.396-2.586 7-2.777 7 2.476v6.759z"/>
                                                </g>
                                            </svg>
                                            <span>LinkedIn</span>
                                        </a>
                                    </li>
                                    <li class="mr-6">
                                        <a class="block py-1 inline-flex items-center text-sm whitespace-nowrap transition-colors duration-200 ease-linear md:text-blue-500 dark:text-blue-400 hover:text-blue-800 dark:hover:text-blue-200" href="https://infosec.exchange/@nxb1t" target="_blank">
                                            <img class="mb-px mr-1" width="18" alt="" src="https://img.icons8.com/external-tal-revivo-color-tal-revivo/24/null/external-mastodon-is-an-online-self-hosted-social-media-and-social-networking-service-logo-color-tal-revivo.png">
                                            <span>Mastodon</span>
                                        </a>
                                    </li>
                                    <li class="mr-6">
                                        <a class="block py-1 inline-flex items-center text-sm whitespace-nowrap transition-colors duration-200 ease-linear md:text-blue-500 dark:text-blue-400 hover:text-blue-800 dark:hover:text-blue-200" href="https://twitter.com/nxb1t4n6" target="_blank">
                                            <svg xmlns="http://www.w3.org/2000/svg" class="mb-px mr-1" width="18" height="18" viewBox="0 0 24 24" role="presentation">
                                                <g fill="currentColor">
                                                    <path d="M19 0h-14c-2.761 0-5 2.239-5 5v14c0 2.761 2.239 5 5 5h14c2.762 0 5-2.239 5-5v-14c0-2.761-2.238-5-5-5zm-.139 9.237c.209 4.617-3.234 9.765-9.33 9.765-1.854 0-3.579-.543-5.032-1.475 1.742.205 3.48-.278 4.86-1.359-1.437-.027-2.649-.976-3.066-2.28.515.098 1.021.069 1.482-.056-1.579-.317-2.668-1.739-2.633-3.26.442.246.949.394 1.486.411-1.461-.977-1.875-2.907-1.016-4.383 1.619 1.986 4.038 3.293 6.766 3.43-.479-2.053 1.08-4.03 3.199-4.03.943 0 1.797.398 2.395 1.037.748-.147 1.451-.42 2.086-.796-.246.767-.766 1.41-1.443 1.816.664-.08 1.297-.256 1.885-.517-.439.656-.996 1.234-1.639 1.697z"/>
                                                </g>
                                            </svg>
                                            <span>Twitter</span>
                                        </a>
                                    </li>
            
                                </ul>
                            </nav>
                        </div>
            
                        <a class="flex items-center justify-center flex-nowrap h-16 text-gray-400 dark:text-dark-400 hover:text-gray-700 dark:hover:text-dark-300 transition-colors duration-150 ease-in docs-powered-by" target="_blank" href="https://retype.com/" rel="noopener">
                            <span class="text-xs whitespace-nowrap">Powered by</span>
                            <svg xmlns="http://www.w3.org/2000/svg" class="ml-2" fill="currentColor" width="96" height="20" overflow="visible"><path d="M0 0v20h13.59V0H0zm11.15 17.54H2.44V2.46h8.71v15.08zM15.8 20h2.44V4.67L15.8 2.22zM20.45 6.89V20h2.44V9.34z"/><g><path d="M40.16 8.44c0 1.49-.59 2.45-1.75 2.88l2.34 3.32h-2.53l-2.04-2.96h-1.43v2.96h-2.06V5.36h3.5c1.43 0 2.46.24 3.07.73s.9 1.27.9 2.35zm-2.48 1.1c.26-.23.38-.59.38-1.09 0-.5-.13-.84-.4-1.03s-.73-.28-1.39-.28h-1.54v2.75h1.5c.72 0 1.2-.12 1.45-.35zM51.56 5.36V7.2h-4.59v1.91h4.13v1.76h-4.13v1.92h4.74v1.83h-6.79V5.36h6.64zM60.09 7.15v7.48h-2.06V7.15h-2.61V5.36h7.28v1.79h-2.61zM70.81 14.64h-2.06v-3.66l-3.19-5.61h2.23l1.99 3.45 1.99-3.45H74l-3.19 5.61v3.66zM83.99 6.19c.65.55.97 1.4.97 2.55s-.33 1.98-1 2.51-1.68.8-3.04.8h-1.23v2.59h-2.06V5.36h3.26c1.42 0 2.45.28 3.1.83zm-1.51 3.65c.25-.28.37-.69.37-1.22s-.16-.92-.48-1.14c-.32-.23-.82-.34-1.5-.34H79.7v3.12h1.38c.68 0 1.15-.14 1.4-.42zM95.85 5.36V7.2h-4.59v1.91h4.13v1.76h-4.13v1.92H96v1.83h-6.79V5.36h6.64z"/></g></svg>
                        </a>
                    </div>
                </template>
            </doc-sidebar>
    
            <div class="grow min-w-0 dark:bg-dark-850">
                <!-- Render "toolbar" template here on api pages --><!-- Render page content -->
                <div class="flex">
                    <div class="min-w-0 p-4 grow md:px-16">
                        <main class="relative pb-12 lg:pt-2">
                            <div class="docs-markdown" id="docs-content">
                                <!-- Rendered if sidebar right is enabled -->
                                <div id="docs-sidebar-right-toggle"></div>
                                <!-- Page content  -->
<doc-anchor-target id="active-directory-lab" class="break-words">
    <h1>
        <doc-anchor-trigger class="header-anchor-trigger" to="#active-directory-lab">#</doc-anchor-trigger>
        <span>Active Directory Lab</span>
    </h1>
</doc-anchor-target>
<div class="-mt-3 mb-12 flex flex-wrap text-sm text-gray-400 dark:text-dark-350 items-center">
    <div class="flex items-center">
        <div>By</div>
        <div class="ml-2 flex items-center">
          <div class="shrink-0 w-8 h-8 overflow-hidden rounded-full">
            <img class="object-cover" src="https://nxb1t.is-a.dev/assets/img/profile.jpeg">
          </div>
          <div class="ml-1 whitespace-nowrap text-gray-500 dark:text-dark-350">nxb1t</div>
        </div>
    </div>
    <div class="mx-2">&#9679;</div>
    <div>In&nbsp;</div>
    <div><a href="../../categories/active-directory/">Active Directory</a>,&nbsp;</div>
    <div><a href="../../categories/lab/">Lab</a>,&nbsp;</div>
    <div><a href="../../categories/incident-response/">Incident Response</a></div>
    <div class="mx-2">&#9679;</div>
    <div class="flex items-center shrink-0">Published&nbsp;<span>2024-09-21</span></div>
</div>

<p>Hello everyone, welcome to my blog on setting up a simple AD lab for practicing Incident Response, Threat Hunting, and Digital Forensics. Once set up, the lab can be easily customized based on use cases, making it more flexible. In this blog, I am focusing only on a host-based incident response scenario, so the policies and integrations I am adding are tailored to that. To make the lab more realistic, the lab&#x27;s theme is centered around a hypothetical tech company named <strong>XOPS</strong>.</p>
<hr>
<doc-anchor-target id="setting-up-the-lab">
    <h2>
        <doc-anchor-trigger class="header-anchor-trigger" to="#setting-up-the-lab">#</doc-anchor-trigger>
        <span>Setting up the Lab</span>
    </h2>
</doc-anchor-target>
<p>Weâ€™re building the infrastructure for XOPS, which includes both Windows and Linux machines connected to the AD environment. The Linux systems are primarily used for automation and backup services. Certain users are restricted to logging in only on specific computers, and the Linux server has LDAP enabled for SSH authentication.</p>
<p>In this lab we are only using <strong>Windows Defender</strong> as endpoint security product and not relying on any EDR/XDR products.</p>
<p>You can refer to <a href="https://github.com/AdiH8/Active-Directory-Lab">Active Directory Lab</a> by AdiH8 for setting up the DC and configuring a basic AD Environment, this requires manual interactions, but if you prefer automated setup you can use <a href="https://github.com/Orange-Cyberdefense/GOAD">GOAD</a> project.</p>
<p>This is how my setup looks like, I have 16 GB of ram in my system, so if yours is less you can reduce the number of client machines.</p>
<div class="table-wrapper scrollbar overflow-hidden">
<table class="comfortable">
<thead>
<tr>
<th>Machine</th>
<th>RAM</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>Windows Server 2019</strong></td>
<td>2GB</td>
</tr>
<tr>
<td><strong>CLIENT 1</strong></td>
<td>2GB</td>
</tr>
<tr>
<td><strong>CLIENT 2</strong></td>
<td>2GB</td>
</tr>
<tr>
<td><strong>Ubuntu Server</strong></td>
<td>1GB</td>
</tr>
</tbody>
</table>
</div>
<p><figure class="content-center">
    <img src="../../assets/img/ad_ir/infra.png" alt="Lab Diagram">
    <figcaption class="caption">Lab Diagram</figcaption>
</figure>
</p>
<p><strong>Configuring Ubuntu Server to join AD Machine</strong></p>
<p>We need to configure ubuntu server to allow AD users ssh login via LDAP. Configuring it is relatively simple. Make sure to set DNS in <code v-pre>/etc/resolv.conf</code> to the IP of DC, in my case its <code v-pre>172.16.0.1</code>.</p>
<div class="codeblock-wrapper"><doc-codeblock>
<pre class="language-bash"><code v-pre class="language-bash">
# Install necessary programs
sudo apt update
sudo apt install realmd sssd sssd-tools libnss-sss libpam-sss adcli

# check if domain is discoverable from the ubuntu, If its not detecting make sure dns is set correct
sudo realm discover xops.local

# join the domain
sudo realm join --user=DomainAdmin xops.local

# list joined domain
sudo realm list</code></pre>
</doc-codeblock></div>
<p><figure class="content-center">
    <img src="../../assets/img/ad_ir/ubuntuad.png" alt="">
    <figcaption class="caption"></figcaption>
</figure>
</p>
<p>After joining the domain, we have to configure few settings to make sure home directory are correctly generated for the domain users, also to make login easier by removing the need of entering domain name along with username (e.g <code v-pre>user</code> instead of <code v-pre>user@xops.local</code>).</p>
<p>Edit <code v-pre>/etc/sssd/sssd.conf</code> and make sure the following line are included, this will allow domain users to ssh login using only their username without the need of specifying domain name.</p>
<div class="codeblock-wrapper"><doc-codeblock>
<pre class="language-bash"><code v-pre class="language-bash">use_fully_qualified_names = False
</code></pre>
</doc-codeblock></div>
<p>Then run the following command to automatically create home directory for domain users.</p>
<div class="codeblock-wrapper"><doc-codeblock>
<pre class="language-bash"><code v-pre class="language-bash">sudo pam-auth-update --enable mkhomedir</code></pre>
</doc-codeblock></div>
<p>Restart the sssd service to apply all changes .</p>
<div class="codeblock-wrapper"><doc-codeblock>
<pre class="language-bash"><code v-pre class="language-bash">sudo systemctl restart sssd</code></pre>
</doc-codeblock></div>
<doc-anchor-target id="configuring-logging-on-machines">
    <h2>
        <doc-anchor-trigger class="header-anchor-trigger" to="#configuring-logging-on-machines">#</doc-anchor-trigger>
        <span>Configuring Logging On Machines</span>
    </h2>
</doc-anchor-target>
<p>In this section we will setup logging mechanisms for both Windows and Ubuntu Machines.</p>
<doc-anchor-target id="setting-up-auditing-in-windows-machines">
    <h3>
        <doc-anchor-trigger class="header-anchor-trigger" to="#setting-up-auditing-in-windows-machines">#</doc-anchor-trigger>
        <span>Setting Up Auditing in Windows Machines</span>
    </h3>
</doc-anchor-target>
<p>Active Directory provides auditing capabilities, with audit policies created and managed through Group Policy Objects (GPOs). These audit policies provide visibility into various security-related activities, such as account logon attempts, changes to user accounts, access to sensitive resources, and system-level events.</p>
<p>New GPO can be created by right clicking on Domain in Group Policy Management application in DC Machine.</p>
<p><figure class="content-center">
    <img src="../../assets/img/ad_ir/group_policies.png" alt="">
    <figcaption class="caption"></figcaption>
</figure>
</p>
<p>Some of the important policies and their corresponding event ids we will focus on this blog are :</p>
<p>-&gt; <strong>Logon Auditing</strong> <br>
Logon events help us identify any malicious or anomalous behaviors related to user logons.<br></p>
<div class="table-wrapper scrollbar overflow-hidden">
<table class="comfortable">
<thead>
<tr>
<th>Event ID</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>4624</strong></td>
<td>An account successfully logged in</td>
</tr>
<tr>
<td><strong>4964</strong></td>
<td>Special Group has been assigned to new logon</td>
</tr>
</tbody>
</table>
</div>
<p>-&gt; <strong>Kerberos Auditing</strong> <br>
Kerberos events gives us better visibility into how tickets are used and helps detect malicious actions related to Kerberos. <br></p>
<div class="table-wrapper scrollbar overflow-hidden">
<table class="comfortable">
<thead>
<tr>
<th>Event ID</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>4768</strong></td>
<td>A Kerberos authentication (TGT) was requested</td>
</tr>
<tr>
<td><strong>4769</strong></td>
<td>A Kerberos service ticket was requested</td>
</tr>
</tbody>
</table>
</div>
<p>-&gt; <strong>Privilege Auditing</strong> <br>
Sensitive privilege events helps us identify unusual usage of elevated permissions and privileged users. <br></p>
<div class="table-wrapper scrollbar overflow-hidden">
<table class="comfortable">
<thead>
<tr>
<th>Event ID</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>4672</strong></td>
<td>Special privileges assigned to new logon</td>
</tr>
<tr>
<td><strong>4673</strong></td>
<td>A privileged service was called</td>
</tr>
</tbody>
</table>
</div>
<p>These event logging can be enabled under <br></p>
<div class="codeblock-wrapper"><doc-codeblock>
<pre class="language-none"><code v-pre class="language-none">Computer Configuration -&gt; Policies -&gt; Windows Settings -&gt; Security Settings -&gt; Advanced Audit Policy Configuration -&gt; Audit Policies</code></pre>
</doc-codeblock></div>
<ul>
<li><strong>Logon Auditing</strong> : Logon/Logoff -&gt; Audit Logon , Audit Special Logon</li>
<li><strong>Kerberos Auditing</strong> : <br>
Account Logon -&gt; Audit Kerberos Authentication Service , Audit Kerberos Service Ticket Operations</li>
<li><strong>Privilege Auditing</strong> : Privilege Use -&gt; Audit Sensitive Privilege Use</li>
</ul>
<p><figure class="content-center">
    <img src="../../assets/img/ad_ir/ad_policies.png" alt="">
    <figcaption class="caption"></figcaption>
</figure>
</p>
<p>--&gt; <strong>Powershell Logging</strong> <br></p>
<p>Powershell logging is essential to identify malicious scripts run on endpoints, it can be enabled under :-</p>
<div class="codeblock-wrapper"><doc-codeblock>
<pre class="language-none"><code v-pre class="language-none">Computer Configuration -&gt; Policies -&gt; Administrative Templates -&gt; Windows Components -&gt; Windows Powershell</code></pre>
</doc-codeblock></div>
<div class="table-wrapper scrollbar overflow-hidden">
<table class="comfortable">
<thead>
<tr>
<th>Event ID</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>4103</strong></td>
<td>Powershell Module Logging</td>
</tr>
<tr>
<td><strong>4104</strong></td>
<td>Powershell Script Block Logging</td>
</tr>
</tbody>
</table>
</div>
<p><figure class="content-center">
    <img src="../../assets/img/ad_ir/powershell_logging.png" alt="">
    <figcaption class="caption"></figcaption>
</figure>
</p>
<p>--&gt; <strong>LDAP Query Monitoring</strong> <br></p>
<p>Monitoring LDAP queries offers an advantage in detecting potential Kerberoasting and AS-REP Roasting attempts, even if no vulnerable service accounts are present in the environment.</p>
<p>So, for detailed logging of ldap queries, we will enable ldap client verbose with 4 registry keys.</p>
<div class="codeblock-wrapper"><doc-codeblock>
<pre class="language-none"><code v-pre class="language-none">Computer Configuration -&gt; Preferences -&gt; Windows Settings -&gt; Registry</code></pre>
</doc-codeblock></div>
<div class="table-wrapper scrollbar overflow-hidden">
<table class="comfortable">
<thead>
<tr>
<th>No</th>
<th>Action</th>
<th>Hive</th>
<th>Key Path</th>
<th>Value name</th>
<th>Value type</th>
<th>Value data</th>
<th>Base</th>
</tr>
</thead>
<tbody>
<tr>
<td>1</td>
<td>Update</td>
<td>HKEY_LOCAL_MACHINE</td>
<td>SYSTEM\CurrentControlSet\Services\NTDS\Diagnostics</td>
<td>15 Field Engineering</td>
<td>REG_DWORD</td>
<td>5</td>
<td>Decimal</td>
</tr>
<tr>
<td>2</td>
<td>Update</td>
<td>HKEY_LOCAL_MACHINE</td>
<td>SYSTEM\CurrentControlSet\Services\NTDS\Parameters</td>
<td>Expensive Search Results Threshold</td>
<td>REG_DWORD</td>
<td>1</td>
<td>Decimal</td>
</tr>
<tr>
<td>3</td>
<td>Update</td>
<td>HKEY_LOCAL_MACHINE</td>
<td>SYSTEM\CurrentControlSet\Services\NTDS\Parameters</td>
<td>Inefficient Search Results Threshold</td>
<td>REG_DWORD</td>
<td>1</td>
<td>Decimal</td>
</tr>
<tr>
<td>4</td>
<td>Update</td>
<td>HKEY_LOCAL_MACHINE</td>
<td>SYSTEM\CurrentControlSet\Services\NTDS\Parameters</td>
<td>Search Time Threshold (msecs)</td>
<td>REG_DWORD</td>
<td>1</td>
<td>Decimal</td>
</tr>
</tbody>
</table>
</div>
<p><figure class="content-center">
    <img src="../../assets/img/ad_ir/ldap_registry.png" alt="">
    <figcaption class="caption"></figcaption>
</figure>
</p>
<div class="table-wrapper scrollbar overflow-hidden">
<table class="comfortable">
<thead>
<tr>
<th>Event ID</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>1644</td>
<td>This event logs an entry for each LDAP search made by a client against the directory that breaches the inexpensive and/or inefficient search thresholds.</td>
</tr>
</tbody>
</table>
</div>
<doc-anchor-target id="installing-sysmon">
    <h3>
        <doc-anchor-trigger class="header-anchor-trigger" to="#installing-sysmon">#</doc-anchor-trigger>
        <span>Installing Sysmon</span>
    </h3>
</doc-anchor-target>
<p>Sysmon offers enhanced logging capabilities for process creation, network connections, and file access-related information. Deploying Sysmon in any Active Directory (AD) environment is highly recommended for improved security monitoring.</p>
<p>We can deploy Sysmon on all systems using GPO policy. Download the <a href="https://learn.microsoft.com/en-us/sysinternals/downloads/sysmon">Sysmon</a> executable and create a share in the DC for deployment. Sysmon&#x27;s power relies on how we configure the tool, by default sysmon doesn&#x27;t offer high level of logging, but with proper configuration we can improve it. I used <a href="https://github.com/SwiftOnSecurity/sysmon-config">SwiftOnSecurity&#x27;s</a> sysmon config as the base config as it covers starter rules, we can modify from there based on our needs.</p>
<p><figure class="content-center">
    <img src="../../assets/img/ad_ir/sysmon_share.png" alt="">
    <figcaption class="caption"></figcaption>
</figure>
</p>
<p>We can use batch script to automate sysmon deployment, this will make things easier and we don&#x27;t need to go to all machines and install from there manually.</p>
<div class="codeblock-wrapper"><doc-codeblock>
<pre class="language-batch"><code v-pre class="language-batch">:: - Reference : https://cybergladius.com/automated-sysmon-deployment/
@echo off

:: - Variables for script.
set str_sysmonShare=DC\Sysmon

:: - Check if running as an Admin
net.exe session 1&gt;NUL 2&gt;NUL || (Echo This script requires elevated rights. &amp; Exit /b 1)

:: - Check is SysMon is running
sc query &quot;Sysmon64&quot; | Find &quot;RUNNING&quot;
If &quot;%ERRORLEVEL%&quot; EQU &quot;1&quot; (
goto StartSysmon
)

:: - Check if SysMon is installed, if not install it.
:StartSysmon
net start sysmon64
If &quot;%ERRORLEVEL%&quot; EQU &quot;1&quot; (
goto InstallSysmon
) else ( exit 0 )

:: - Install the SysMon agent from the Share.
:InstallSysmon
&quot;\\%str_sysmonShare%\Sysmon64.exe&quot; -i -accepteula
If &quot;%ERRORLEVEL%&quot; EQU &quot;1&quot; (
echo &quot;An Error occured while loading the SysMon Config.&quot;
)

exit 0
</code></pre>
</doc-codeblock></div>
<p>Then we have to add Domain Computers group read access in share, which makes the share accessible for all computers.</p>
<p><figure class="content-center">
    <img src="../../assets/img/ad_ir/sysmon_share2.png" alt="">
    <figcaption class="caption"></figcaption>
</figure>
</p>
<p><figure class="content-center">
    <img src="../../assets/img/ad_ir/sysmon_share3.png" alt="">
    <figcaption class="caption"></figcaption>
</figure>
</p>
<p>Finally create the GPO and add the batch file in Startup scripts, apply <code v-pre>gpudate /force</code> on clients and reboot.</p>
<p><figure class="content-center">
    <img src="../../assets/img/ad_ir/sysmon_gpo.png" alt="">
    <figcaption class="caption"></figcaption>
</figure>
</p>
<p><figure class="content-center">
    <img src="../../assets/img/ad_ir/gpupdate.png" alt="">
    <figcaption class="caption"></figcaption>
</figure>
</p>
<p>Use <code v-pre>sc query sysmon64</code> to verify the Sysmon Service is running.</p>
<p><figure class="content-center">
    <img src="../../assets/img/ad_ir/sysmon_deployed.png" alt="">
    <figcaption class="caption"></figcaption>
</figure>
</p>
<p>Some Important event ids generated by Sysmon are :- <br></p>
<div class="table-wrapper scrollbar overflow-hidden">
<table class="comfortable">
<thead>
<tr>
<th>Event ID</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>1</strong></td>
<td>Process Created</td>
</tr>
<tr>
<td><strong>3</strong></td>
<td>Network Connection</td>
</tr>
<tr>
<td><strong>7</strong></td>
<td>Image Loaded</td>
</tr>
<tr>
<td><strong>11</strong></td>
<td>File Create</td>
</tr>
</tbody>
</table>
</div>
<doc-anchor-target id="configuring-ubuntu-machine">
    <h3>
        <doc-anchor-trigger class="header-anchor-trigger" to="#configuring-ubuntu-machine">#</doc-anchor-trigger>
        <span>Configuring Ubuntu Machine</span>
    </h3>
</doc-anchor-target>
<p>For setting up logging in ubuntu we will use auditd. auditd is the Linux Audit daemon responsible for tracking and logging system activities. It provides detailed event records, including file access, user actions, and security policy changes, making it valuable for monitoring and incident response.</p>
<div class="codeblock-wrapper"><doc-codeblock>
<pre class="language-bash"><code v-pre class="language-bash"># install auditd
sudo apt install -y auditd</code></pre>
</doc-codeblock></div>
<p>By default auditd only logs events like ssh login, use of sudo, pam. This is great but can be improved to get more telemetry from the systems. We can monitor specific files and folders for any modifications being occured there. Monitoring <code v-pre>/tmp/</code> folder is highly useful to trace if any data is being dumped there and so on.</p>
<p>We can monitor tmp folder by applying this auditd rule :</p>
<div class="codeblock-wrapper"><doc-codeblock>
<pre class="language-bash"><code v-pre class="language-bash">sudo echo &quot;-w /tmp/ -p rwxa -k tmp_watch&quot; &gt; /etc/audit/rules.d/audit.rules</code></pre>
</doc-codeblock></div>
<p>What it does is, monitor tmp folder for any read,write,execute,append actions performed. Then we have to restart auditd service to apply the rule.</p>
<div class="codeblock-wrapper"><doc-codeblock>
<pre class="language-bash"><code v-pre class="language-bash">sudo systemctl restart auditd</code></pre>
</doc-codeblock></div>
<doc-anchor-target id="installing-siem-agents-on-machines">
    <h3>
        <doc-anchor-trigger class="header-anchor-trigger" to="#installing-siem-agents-on-machines">#</doc-anchor-trigger>
        <span>Installing SIEM Agents on Machines</span>
    </h3>
</doc-anchor-target>
<p>For SIEM, ELK stack is the best free option. Elastic even provides a 14 day free trial of their cloud version so we don&#x27;t have to setup anything locally.</p>
<p>Once the free account is created, Install the elastic agent on the DC and clients, <a href="https://www.elastic.co/guide/en/fleet/current/install-fleet-managed-elastic-agent.html">refer here</a> for a detailed guide on installing the agents. Agents can be also deployed using GPO, but here i installed them manually on clients and DC.</p>
<p><figure class="content-center">
    <img src="../../assets/img/ad_ir/fleet.png" alt="">
    <figcaption class="caption"></figcaption>
</figure>
</p>
<p>Once the agents are installed, enable the <code v-pre>System</code> integration and <code v-pre>Windows</code> integration for the agents. These two integrations will forward events from <strong>Application</strong> , <strong>Security</strong> , <strong>Sysmon</strong> and <strong>Powershell/Operational</strong> event log channels.</p>
<p><figure class="content-center">
    <img src="../../assets/img/ad_ir/c_agent_intg.png" alt="">
    <figcaption class="caption"></figcaption>
</figure>
</p>
<p>For DC, we need to create a separate agent policy and add one more additional integration named <strong>Custom Windows Event Logs</strong> to collect LDAP queries.</p>
<p><figure class="content-center">
    <img src="../../assets/img/ad_ir/dc_agent_intg.png" alt="">
    <figcaption class="caption"></figcaption>
</figure>
</p>
<p>In the channel name enter : Directory Service.</p>
<p><figure class="content-center">
    <img src="../../assets/img/ad_ir/custom_evnt.png" alt="">
    <figcaption class="caption"></figcaption>
</figure>
</p>
<p>And for linux machines, we need to use <strong>auditd</strong> integration.</p>
<p><figure class="content-center">
    <img src="../../assets/img/ad_ir/ubuntuagent.png" alt="">
    <figcaption class="caption"></figcaption>
</figure>
</p>
<hr>
<p>With this, our Lab is setup to log many of the events and we can conduct different types of attack simulations for learning Incident Response, Digital Forensics and Threat Hunting. You are free to add more integrations and logging mechaninsms to make this lab even better for your use-cases.</p>
<p>Check out an example Incident Response scenario based on this Lab :-</p>
<p>
<div class="mb-6 px-5 py-4 flex justify-between relative border border-gray-300 hover:border-gray-400 dark:border-dark-650 dark:hover:border-dark-450 rounded transition-colors duration-150">
    <div class="flex items-center text-blue-500 dark:text-blue-400">
        <span class="inline-block mb-px">
            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" role="presentation" fill="currentColor"><path fill="none" d="M0 0h24v24H0z"/><path d="M19.92 12.38a1 1 0 00-.22-1.09l-7-7a.996.996 0 10-1.41 1.41l5.3 5.3H5c-.55 0-1 .45-1 1s.45 1 1 1h11.59l-5.29 5.29a.996.996 0 000 1.41c.19.2.44.3.7.3s.51-.1.71-.29l7-7c.09-.09.16-.21.21-.33z"/></svg>
        </span>
        <span class="inline-block font-medium ml-2">Practical Incident Response - Active Directory</span>
    </div>
    <div class="flex items-center text-xs text-gray-400 dark:text-dark-400">
        <span>https://nxb1t.is-a.dev/incident-response/practical_ir_ad/</span>
    </div>
    <a href="https://nxb1t.is-a.dev/incident-response/practical_ir_ad/" class="absolute block inset-0"></a>
</div>
</p>
<doc-anchor-target id="references">
    <h2>
        <doc-anchor-trigger class="header-anchor-trigger" to="#references">#</doc-anchor-trigger>
        <span>References</span>
    </h2>
</doc-anchor-target>
<ul>
<li><a href="https://techexpert.tips/windows/gpo-monitor-ldap-queries-active-directory/">GPO Monitor LDAP Queries</a></li>
<li><a href="https://medium.com/bugbountywriteup/build-it-before-breaking-it-5d8c5b8171fc">Build it Before Breaking It</a></li>
</ul>

                                <div class="flex items-center mt-6 mb-6 clear-both">
                                    <span>
                                        <a href="../../tags/">
                                            <svg class="inline-block -mb-px mr-1.5 text-blue-500 dark:text-blue-400" xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" overflow="visible" fill="currentColor"><g><path d="M21.3 9.88l-8.59-8.59C12.52 1.11 12.27 1 12 1H2c-.55 0-1 .45-1 1v10c0 .27.11.52.29.71l8.59 8.58c.57.57 1.32.88 2.12.88s1.55-.31 2.12-.88l7.17-7.17a3.009 3.009 0 00.01-4.24zm-1.42 2.82l-7.17 7.17c-.39.39-1.02.39-1.42 0L3 11.59V3h8.59l8.29 8.29c.39.39.39 1.03 0 1.41z" /><path d="M7.01 6C6.45 6 6 6.45 6 7s.45 1 1 1 1-.45 1-1-.44-1-.99-1z" /></g></svg>
                                        </a>
                                        <span class="mr-2"><a href="../../tags/active-directory/" class="no-link inline-flex align-middle items-center justify-center font-medium leading-none whitespace-nowrap text-blue-500 dark:text-blue-400 border border-blue-500 dark:border-blue-400 hover:bg-blue-100 dark:hover:bg-transparent dark:hover:border-blue-200 dark:hover:text-blue-200 transition-colors duration-200 ease-out h-6 px-2 text-xs rounded-md">
                                    <span>active directory</span>
                                </a></span>
                                        <span class="mr-2"><a href="../../tags/lab/" class="no-link inline-flex align-middle items-center justify-center font-medium leading-none whitespace-nowrap text-blue-500 dark:text-blue-400 border border-blue-500 dark:border-blue-400 hover:bg-blue-100 dark:hover:bg-transparent dark:hover:border-blue-200 dark:hover:text-blue-200 transition-colors duration-200 ease-out h-6 px-2 text-xs rounded-md">
                                    <span>lab</span>
                                </a></span>
                                        <span class="mr-2"><a href="../../tags/incident-response/" class="no-link inline-flex align-middle items-center justify-center font-medium leading-none whitespace-nowrap text-blue-500 dark:text-blue-400 border border-blue-500 dark:border-blue-400 hover:bg-blue-100 dark:hover:bg-transparent dark:hover:border-blue-200 dark:hover:text-blue-200 transition-colors duration-200 ease-out h-6 px-2 text-xs rounded-md">
                                    <span>incident response</span>
                                </a></span>
                                    </span>
                                </div>
                
                                <!-- Required only on API pages -->
                                <doc-toolbar-member-filter-no-results></doc-toolbar-member-filter-no-results>
                            </div>
                            <footer class="clear-both">
                            
                                <nav class="flex mt-14">
                                    <div class="w-1/2">
                                        <a class="px-5 py-4 h-full flex items-center break-normal font-medium text-blue-500 dark:text-blue-400 border border-gray-300 hover:border-gray-400 dark:border-dark-650 dark:hover:border-dark-450 rounded-l-lg transition-colors duration-150 relative hover:z-5" href="../../incident-response/practical_ir_ad/">
                                            <svg xmlns="http://www.w3.org/2000/svg" class="mr-3" width="24" height="24" viewBox="0 0 24 24" fill="currentColor" overflow="visible"><path d="M19 11H7.41l5.29-5.29a.996.996 0 10-1.41-1.41l-7 7a1 1 0 000 1.42l7 7a1.024 1.024 0 001.42-.01.996.996 0 000-1.41L7.41 13H19c.55 0 1-.45 1-1s-.45-1-1-1z" /><path fill="none" d="M0 0h24v24H0z" /></svg>
                                            <span>
                                                <span class="block text-xs font-normal text-gray-400 dark:text-dark-400">Previous</span>
                                                <span class="block mt-1">Practical Incident Response - Active Directory</span>
                                            </span>
                                        </a>
                                    </div>
                            
                                    <div class="w-1/2">
                                        <a class="px-5 py-4 -mx-px h-full flex items-center justify-end break-normal font-medium text-blue-500 dark:text-blue-400 border border-gray-300 hover:border-gray-400 dark:border-dark-650 dark:hover:border-dark-450 rounded-r-lg transition-colors duration-150 relative hover:z-5" href="../../malware-analysis/rust_malware/">
                                            <span>
                                                <span class="block text-xs font-normal text-right text-gray-400 dark:text-dark-400">Next</span>
                                                <span class="block mt-1">A Closer Look At Rust Based Malware</span>
                                            </span>
                                            <svg xmlns="http://www.w3.org/2000/svg" class="ml-3" width="24" height="24" viewBox="0 0 24 24" fill="currentColor" overflow="visible"><path d="M19.92 12.38a1 1 0 00-.22-1.09l-7-7a.996.996 0 10-1.41 1.41l5.3 5.3H5c-.55 0-1 .45-1 1s.45 1 1 1h11.59l-5.29 5.29a.996.996 0 000 1.41c.19.2.44.3.7.3s.51-.1.71-.29l7-7c.09-.09.16-.21.21-.33z" /><path fill="none" d="M0 0h24v24H0z" /></svg>
                                        </a>
                                    </div>
                                </nav>
                            </footer>
                        </main>
                
                        <div class="border-t dark:border-dark-650 pt-6 mb-8">
                            <footer class="flex flex-wrap items-center justify-between">
                                <div>
                                    <ul class="flex flex-wrap items-center text-sm">
                                    </ul>
                                </div>
                                <div class="docs-copyright py-2 text-gray-500 dark:text-dark-350 text-sm leading-relaxed"><p>Â© 2024 - <a href="https://nxb1t.is-a.dev">nxb1t.is-a.dev</a> - All rights reserved</p></div>
                            </footer>
                        </div>
                    </div>
                
                    <!-- Rendered if sidebar right is enabled -->
                    <!-- Sidebar right skeleton-->
                    <div v-cloak class="fixed top-0 bottom-0 right-0 translate-x-full bg-white border-gray-200 lg:sticky lg:border-l lg:shrink-0 lg:pt-6 lg:transform-none sm:w-1/2 lg:w-64 lg:z-0 md:w-104 sidebar-right skeleton dark:bg-dark-850 dark:border-dark-650">
                        <div class="pl-5">
                            <div class="w-32 h-3 mb-4 bg-gray-200 dark:bg-dark-600 rounded-full loading"></div>
                            <div class="w-48 h-3 mb-4 bg-gray-200 dark:bg-dark-600 rounded-full loading"></div>
                            <div class="w-40 h-3 mb-4 bg-gray-200 dark:bg-dark-600 rounded-full loading"></div>
                        </div>
                    </div>
                
                    <!-- User should be able to hide sidebar right -->
                    <doc-sidebar-right v-cloak></doc-sidebar-right>
                </div>

            </div>
        </div>
    
        <doc-search-mobile></doc-search-mobile>
        <doc-back-to-top></doc-back-to-top>
    </div>


    <div id="docs-overlay-target"></div>

    <script data-cfasync="false">window.__DOCS__ = { "title": "Active Directory Lab", level: 2, icon: "file", hasPrism: true, hasMermaid: false, hasMath: false, tocDepth: 23 }</script>
</body>
</html>
